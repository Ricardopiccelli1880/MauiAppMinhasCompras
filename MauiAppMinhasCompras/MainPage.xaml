<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:MauiAppMinhasCompras.Models"
    x:Class="MauiAppMinhasCompras.MainPage"
    Title="Produtos">

    <ContentPage.Padding>
        <OnPlatform x:TypeArguments="Thickness">
            <On Platform="Android,iOS" Value="16,16,16,8" />
            <On Platform="WinUI,MacCatalyst" Value="24" />
        </OnPlatform>
    </ContentPage.Padding>

    <Grid RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="*">

        <Label Text="Produtos" FontSize="28" FontAttributes="Bold" />

        <!-- Form -->
        <Grid Grid.Row="1" ColumnDefinitions="2*,Auto,Auto,Auto,Auto" ColumnSpacing="8">
            <Entry x:Name="DescricaoEntry" Placeholder="Descrição" Grid.Column="0"/>
            <Entry x:Name="QuantidadeEntry" Placeholder="Qtde" Keyboard="Numeric" WidthRequest="80" Grid.Column="1"/>
            <Entry x:Name="PrecoEntry" Placeholder="Preço" Keyboard="Numeric" WidthRequest="100" Grid.Column="2"/>
            <Button Text="{Binding BotaoSalvarTexto}" Clicked="OnSalvarClicked" Grid.Column="3"/>
            <Button Text="Limpar" Clicked="OnLimparClicked" Grid.Column="4"/>
        </Grid>

        <!-- Ações, busca e lista -->
        <Grid Grid.Row="2"
              RowDefinitions="Auto,Auto,*"
              ColumnDefinitions="Auto,Auto,Auto"
              ColumnSpacing="8">

            <!-- Busca -->
            <SearchBar Grid.Row="0" Grid.ColumnSpan="3"
                       Placeholder="Buscar descrição"
                       TextChanged="OnBuscarTextChanged" />

            <!-- Botões -->
            <Button Grid.Row="1" Grid.Column="0" Text="Adicionar Produto Exemplo" Clicked="OnAdicionarExemploClicked" />
            <Button Grid.Row="1" Grid.Column="1" Text="Mostrar Produtos" Clicked="OnRecarregarClicked" />
            <Button Grid.Row="1" Grid.Column="2" Text="Resetar Banco" Clicked="OnResetarBancoClicked" />

            <!-- Lista -->
            <CollectionView Grid.Row="2" Grid.ColumnSpan="3"
                            x:Name="ProdutosListView"
                            ItemsSource="{Binding Produtos}"
                            SelectionChanged="ProdutosListView_SelectionChanged">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Produto">
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems Mode="Reveal">
                                    <SwipeItem Text="Excluir"
                                               BackgroundColor="Tomato"
                                               CommandParameter="{Binding .}"
                                               Invoked="OnExcluirSwipeInvoked"/>
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <Grid Padding="8" ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <Label Text="{Binding Descricao}" FontSize="18" />
                                <StackLayout Grid.Column="1" Orientation="Horizontal" Spacing="6">
                                    <Label Text="{Binding Quantidade}" />
                                    <Label Text="x" />
                                    <Label Text="{Binding Preco, StringFormat='R$ {0:N2}'}" />
                                </StackLayout>
                            </Grid>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <Label Text="Nenhum produto cadastrado." Padding="12" />
                </CollectionView.EmptyView>
            </CollectionView>
        </Grid>

        <!-- Total -->
        <Grid Grid.Row="3" ColumnDefinitions="*,Auto" Padding="0,8,0,0">
            <Label Text="Total:" FontAttributes="Bold" />
            <Label Grid.Column="1"
                   Text="{Binding Total, StringFormat='R$ {0:N2}'}"
                   FontAttributes="Bold" />
        </Grid>

    </Grid>
</ContentPage>
